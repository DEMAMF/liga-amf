<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMF - Sistema de Gestión Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { border-bottom: 4px solid #2563eb; color: #2563eb; background-color: white; }
        .admin-only { display: none !important; }
        body.is-admin .admin-only { display: block !important; }
        .team-logo { width: 28px; height: 28px; object-fit: contain; }
        .card-yellow { width: 10px; height: 14px; background: #fbbf24; border-radius: 2px; display: inline-block; border: 1px solid #d97706; }
        .card-red { width: 10px; height: 14px; background: #ef4444; border-radius: 2px; display: inline-block; border: 1px solid #b91c1c; }
    </style>
</head>
<body class="min-h-screen pb-10">

    <div class="max-w-6xl mx-auto md:mt-6 bg-white md:rounded-3xl shadow-2xl overflow-hidden border border-slate-200">
        
        <!-- HEADER -->
        <div class="bg-slate-900 p-6 text-white flex flex-col md:flex-row justify-between items-center gap-4 relative">
            <div class="flex items-center gap-4">
                <img src="logo_liga.png" alt="AMF" class="h-16 w-auto" onerror="this.src='https://via.placeholder.com/60?text=AMF'">
                <div>
                    <h1 class="text-xl font-black italic uppercase leading-none">Asociación Metropolitana</h1>
                    <p class="text-blue-400 font-bold text-xs tracking-tighter uppercase">Sistema de Gestión de Fútbol</p>
                </div>
            </div>

            <div class="flex gap-2">
                <button onclick="exportarPDF()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-black text-[10px] uppercase flex items-center gap-2 transition-all">
                    PDF Reporte
                </button>
                <button onclick="toggleAdmin()" class="bg-slate-800 hover:bg-blue-600 text-white p-2 rounded-lg transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg>
                </button>
            </div>
        </div>

        <!-- MENU PRINCIPAL -->
        <nav class="flex border-b bg-slate-50 overflow-x-auto">
            <button onclick="showTab('equipos')" id="btn-equipos" class="tab-button active px-6 py-4 font-black text-[11px] uppercase tracking-widest text-slate-500 whitespace-nowrap">Clubes</button>
            <button onclick="showTab('partidos')" id="btn-partidos" class="tab-button px-6 py-4 font-black text-[11px] uppercase tracking-widest text-slate-500 whitespace-nowrap">Resultados</button>
            <button onclick="showTab('tabla')" id="btn-tabla" class="tab-button px-6 py-4 font-black text-[11px] uppercase tracking-widest text-slate-500 whitespace-nowrap">Tabla x Categoría</button>
            <button onclick="showTab('general')" id="btn-general" class="tab-button px-6 py-4 font-black text-[11px] uppercase tracking-widest text-slate-500 whitespace-nowrap">Tabla General</button>
        </nav>

        <main class="p-4 md:p-8">
            
            <!-- SECCIÓN CLUBES -->
            <div id="equipos" class="tab-content active">
                <div class="admin-only mb-8 space-y-4">
                    <div class="bg-blue-50 p-6 rounded-2xl border-2 border-dashed border-blue-200 flex flex-wrap gap-3">
                        <input type="text" id="new-team-name" placeholder="NOMBRE DEL NUEVO CLUB..." class="flex-1 p-3 rounded-xl font-bold uppercase border-none ring-2 ring-blue-100 outline-blue-500">
                        <button onclick="addTeam()" class="bg-blue-600 text-white px-6 rounded-xl font-black uppercase text-xs">Registrar Club</button>
                        <label class="bg-green-600 text-white px-6 py-3 rounded-xl font-black uppercase text-xs cursor-pointer hover:bg-green-700 transition-all">
                            Importar Excel
                            <input type="file" id="excel-input" class="hidden" accept=".xlsx, .xls" onchange="importExcel(event)">
                        </label>
                        <button onclick="resetData()" class="bg-red-500 text-white px-6 rounded-xl font-black uppercase text-xs italic">Reiniciar Todo</button>
                    </div>
                </div>
                <div id="team-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
            </div>

            <!-- SECCIÓN RESULTADOS -->
            <div id="partidos" class="tab-content">
                <!-- PANEL CARGA ADMINISTRADOR -->
                <div class="admin-only bg-slate-100 p-6 rounded-2xl mb-8 border border-slate-200">
                    <h3 class="font-black uppercase text-sm mb-4 text-slate-600 italic underline">Cargar Nuevo Resultado</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <select id="m-category" class="p-3 rounded-xl font-bold text-xs uppercase shadow-sm outline-blue-500">
                            <option value="SUB15 FEMENINO">SUB15 FEMENINO</option>
                            <option value="SUB17 FEMENINO">SUB17 FEMENINO</option>
                            <option value="1º DIVISION FEMENINIO">1º DIVISION FEMENINIO</option>
                            <option value="6º DIVISION">6º DIVISION</option>
                            <option value="5º DIVISION">5º DIVISION</option>
                            <option value="4º DIVISION">4º DIVISION</option>
                            <option value="3º DIVISION">3º DIVISION</option>
                            <option value="1º DIVISION">1º DIVISION</option>
                            <option value="SENIOR">SENIOR</option>
                        </select>
                        <input type="text" id="m-round" placeholder="FECHA (EJ: FECHA 1)" class="p-3 rounded-xl font-bold text-xs uppercase shadow-sm">
                        <input type="text" id="m-tournament" value="TORNEO OFICIAL" class="p-3 rounded-xl font-bold text-xs uppercase shadow-sm">
                    </div>
                    
                    <div class="flex flex-col md:flex-row items-center gap-4 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <!-- Local -->
                        <div class="flex-1 w-full space-y-3">
                            <select id="m-local" class="w-full p-2 font-black uppercase border-b-2 border-slate-100 focus:border-blue-500 outline-none"></select>
                            <div class="flex gap-2">
                                <div class="relative flex-1">
                                    <span class="absolute left-2 top-2 text-[8px] font-bold text-yellow-600 uppercase">Am</span>
                                    <input type="number" id="y-local" value="0" min="0" class="w-full p-2 pl-6 bg-yellow-50 rounded text-xs font-bold border border-yellow-200">
                                </div>
                                <div class="relative flex-1">
                                    <span class="absolute left-2 top-2 text-[8px] font-bold text-red-600 uppercase">Ro</span>
                                    <input type="number" id="r-local" value="0" min="0" class="w-full p-2 pl-6 bg-red-50 rounded text-xs font-bold border border-red-200">
                                </div>
                            </div>
                        </div>

                        <!-- Goles -->
                        <div class="flex items-center gap-3">
                            <input type="number" id="g-local" placeholder="0" class="w-16 h-16 text-center font-black text-3xl bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-blue-500 outline-none">
                            <span class="font-black text-slate-300 italic">VS</span>
                            <input type="number" id="g-visitor" placeholder="0" class="w-16 h-16 text-center font-black text-3xl bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-blue-500 outline-none">
                        </div>

                        <!-- Visitante -->
                        <div class="flex-1 w-full space-y-3">
                            <select id="m-visitor" class="w-full p-2 font-black uppercase border-b-2 border-slate-100 focus:border-blue-500 outline-none"></select>
                            <div class="flex gap-2">
                                <div class="relative flex-1">
                                    <span class="absolute left-2 top-2 text-[8px] font-bold text-yellow-600 uppercase">Am</span>
                                    <input type="number" id="y-visitor" value="0" min="0" class="w-full p-2 pl-6 bg-yellow-50 rounded text-xs font-bold border border-yellow-200">
                                </div>
                                <div class="relative flex-1">
                                    <span class="absolute left-2 top-2 text-[8px] font-bold text-red-600 uppercase">Ro</span>
                                    <input type="number" id="r-visitor" value="0" min="0" class="w-full p-2 pl-6 bg-red-50 rounded text-xs font-bold border border-red-200">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button onclick="addMatch()" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-black uppercase text-sm shadow-xl transition-all">Guardar Partido y Estadísticas</button>
                </div>

                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-black text-slate-800 uppercase italic">Historial de Partidos</h2>
                    <select id="filter-cat-matches" onchange="render()" class="bg-white border p-2 rounded-lg font-bold text-[10px] uppercase">
                        <option value="TODAS">Ver Todas las Categorías</option>
                    </select>
                </div>
                <div id="match-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>

            <!-- SECCIÓN TABLA DE POSICIONES POR CATEGORÍA -->
            <div id="tabla" class="tab-content">
                <div class="mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                    <h2 class="text-xl font-black text-slate-800 uppercase italic">Posiciones por Categoría</h2>
                    <select id="filter-category-table" onchange="updateStandings()" class="bg-blue-600 text-white p-3 rounded-xl font-black text-xs uppercase outline-none shadow-lg">
                        <option value="SUB15 FEMENINO">SUB15 FEMENINO</option>
                        <option value="SUB17 FEMENINO">SUB17 FEMENINO</option>
                        <option value="1º DIVISION FEMENINIO">1º DIVISION FEMENINIO</option>
                        <option value="6º DIVISION">6º DIVISION</option>
                        <option value="5º DIVISION">5º DIVISION</option>
                        <option value="4º DIVISION">4º DIVISION</option>
                        <option value="3º DIVISION">3º DIVISION</option>
                        <option value="1º DIVISION">1º DIVISION</option>
                        <option value="SENIOR">SENIOR</option>
                    </select>
                </div>
                <div class="overflow-x-auto rounded-2xl border border-slate-200 shadow-xl">
                    <table class="w-full text-sm text-left bg-white">
                        <thead class="bg-slate-900 text-white uppercase font-black text-[9px]">
                            <tr>
                                <th class="p-4 text-center">Pos</th>
                                <th class="p-4">Club</th>
                                <th class="p-2 text-center">PJ</th>
                                <th class="p-2 text-center">PG</th>
                                <th class="p-2 text-center">PE</th>
                                <th class="p-2 text-center">PP</th>
                                <th class="p-2 text-center">GF</th>
                                <th class="p-2 text-center">GC</th>
                                <th class="p-2 text-center">DG</th>
                                <th class="p-2 text-center text-yellow-400">AM</th>
                                <th class="p-2 text-center text-red-500">RO</th>
                                <th class="p-4 text-center bg-blue-600">PTS</th>
                            </tr>
                        </thead>
                        <tbody id="standings-body" class="divide-y divide-slate-100 font-bold uppercase italic text-[11px]"></tbody>
                    </table>
                </div>
            </div>

            <!-- SECCIÓN TABLA GENERAL -->
            <div id="general" class="tab-content">
                <div class="mb-6">
                    <h2 class="text-xl font-black text-slate-800 uppercase italic">Tabla General de Clubes</h2>
                    <p class="text-[10px] text-slate-400 font-bold uppercase">Suma de puntos de todas las categorías cargadas.</p>
                </div>
                <div class="overflow-x-auto rounded-2xl border border-slate-200 shadow-xl">
                    <table class="w-full text-sm text-left bg-white">
                        <thead class="bg-slate-800 text-white uppercase font-black text-[10px]">
                            <tr>
                                <th class="p-4 text-center w-16">Pos</th>
                                <th class="p-4">Club</th>
                                <th class="p-4 text-center">Categorías con Actividad</th>
                                <th class="p-4 text-center bg-blue-700">Puntos Totales</th>
                            </tr>
                        </thead>
                        <tbody id="general-body" class="divide-y divide-slate-100 font-bold uppercase italic text-[12px]"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        const ADMIN_KEY = "admin123";
        let teams = JSON.parse(localStorage.getItem('amf_db_teams')) || [];
        let matches = JSON.parse(localStorage.getItem('amf_db_matches')) || [];
        let isAdminActive = false;
        let currentTabId = 'equipos';

        const CATEGORIES = [
            "SUB15 FEMENINO", "SUB17 FEMENINO", "1º DIVISION FEMENINIO", 
            "6º DIVISION", "5º DIVISION", "4º DIVISION", "3º DIVISION", 
            "1º DIVISION", "SENIOR"
        ];

        function getShield(name) {
            return `escudos/${name.toUpperCase().trim()}.png`;
        }

        function toggleAdmin() {
            const pass = prompt("Acceso Administrador:");
            if(pass === ADMIN_KEY) {
                isAdminActive = true;
                document.body.classList.add('is-admin');
                render();
            } else {
                isAdminActive = false;
                document.body.classList.remove('is-admin');
                render();
            }
        }

        function showTab(id) {
            currentTabId = id;
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-'+id).classList.add('active');
            
            if(id === 'tabla') updateStandings();
            if(id === 'general') updateGeneralTable();
            render();
        }

        function addTeam() {
            const val = document.getElementById('new-team-name').value.trim().toUpperCase();
            if(val && !teams.includes(val)) {
                teams.push(val);
                document.getElementById('new-team-name').value = '';
                save();
            }
        }

        function addMatch() {
            const gL = parseInt(document.getElementById('g-local').value);
            const gV = parseInt(document.getElementById('g-visitor').value);

            const m = {
                category: document.getElementById('m-category').value,
                round: document.getElementById('m-round').value.toUpperCase() || 'FECHA',
                tour: document.getElementById('m-tournament').value.toUpperCase(),
                local: document.getElementById('m-local').value,
                visitor: document.getElementById('m-visitor').value,
                gL: isNaN(gL) ? null : gL,
                gV: isNaN(gV) ? null : gV,
                yL: parseInt(document.getElementById('y-local').value) || 0,
                rL: parseInt(document.getElementById('r-local').value) || 0,
                yV: parseInt(document.getElementById('y-visitor').value) || 0,
                rV: parseInt(document.getElementById('r-visitor').value) || 0,
                id: Date.now()
            };

            if(m.local === m.visitor) return alert("Selecciona clubes diferentes");
            if(m.gL === null || m.gV === null) return alert("Ingresa los goles del partido");

            matches.push(m);
            save();
            
            ['g-local','g-visitor','y-local','r-local','y-visitor','r-visitor'].forEach(id => document.getElementById(id).value = id.startsWith('g') ? '' : '0');
        }

        function importExcel(e) {
            const reader = new FileReader();
            reader.onload = (evt) => {
                const bstr = evt.target.result;
                const wb = XLSX.read(bstr, {type:'binary'});
                const ws = wb.Sheets[wb.SheetNames[0]];
                const data = XLSX.utils.sheet_to_json(ws);
                
                data.forEach(row => {
                    const club = String(row.CLUB || row.Club || "").trim().toUpperCase();
                    if(club && !teams.includes(club)) teams.push(club);
                });
                save();
                alert("Clubes importados");
            };
            reader.readAsBinaryString(e.target.files[0]);
        }

        function getTableData(cat) {
            const table = {};
            teams.forEach(t => table[t] = { name:t, pj:0, pg:0, pe:0, pp:0, gf:0, gc:0, pts:0, y:0, r:0 });
            
            matches.filter(m => m.category === cat && m.gL !== null).forEach(m => {
                const l = table[m.local], v = table[m.visitor];
                if(!l || !v) return;
                
                l.pj++; v.pj++;
                l.gf += m.gL; l.gc += m.gV;
                v.gf += m.gV; v.gc += m.gL;
                
                l.y += (m.yL || 0); l.r += (m.rL || 0);
                v.y += (m.yV || 0); v.r += (m.rV || 0);

                if(m.gL > m.gV) { l.pg++; l.pts += 3; v.pp++; }
                else if(m.gV > m.gL) { v.pg++; v.pts += 3; l.pp++; }
                else { l.pe++; v.pe++; l.pts += 1; v.pts += 1; }
            });

            return Object.values(table).sort((a,b) => b.pts - a.pts || (b.gf-b.gc)-(a.gf-a.gc) || b.gf - a.gf);
        }

        function updateStandings() {
            const cat = document.getElementById('filter-category-table').value;
            const data = getTableData(cat);
            document.getElementById('standings-body').innerHTML = data.map((s, i) => `
                <tr class="${i < 4 ? 'bg-blue-50/20' : 'bg-white'}">
                    <td class="p-4 text-center font-black text-slate-400 border-r">${i+1}</td>
                    <td class="p-4 flex items-center gap-3">
                        <img src="${getShield(s.name)}" class="team-logo" onerror="this.src='https://via.placeholder.com/28?text=${s.name.charAt(0)}'">
                        <span class="truncate">${s.name}</span>
                    </td>
                    <td class="p-2 text-center text-slate-500">${s.pj}</td>
                    <td class="p-2 text-center text-green-600">${s.pg}</td>
                    <td class="p-2 text-center text-slate-400">${s.pe}</td>
                    <td class="p-2 text-center text-red-400">${s.pp}</td>
                    <td class="p-2 text-center">${s.gf}</td>
                    <td class="p-2 text-center">${s.gc}</td>
                    <td class="p-2 text-center font-bold">${s.gf - s.gc}</td>
                    <td class="p-2 text-center text-yellow-600 bg-yellow-50/50">${s.y}</td>
                    <td class="p-2 text-center text-red-700 bg-red-50/50">${s.r}</td>
                    <td class="p-4 text-center bg-blue-600 text-white font-black text-sm">${s.pts}</td>
                </tr>
            `).join('');
        }

        function updateGeneralTable() {
            const general = {};
            teams.forEach(t => general[t] = { name: t, pts: 0, cats: new Set() });

            CATEGORIES.forEach(cat => {
                const catData = getTableData(cat);
                catData.forEach(s => {
                    if(s.pj > 0) {
                        general[s.name].pts += s.pts;
                        general[s.name].cats.add(cat);
                    }
                });
            });

            const sorted = Object.values(general).sort((a,b) => b.pts - a.pts);

            document.getElementById('general-body').innerHTML = sorted.map((s, i) => `
                <tr class="hover:bg-slate-50 transition-colors">
                    <td class="p-4 text-center text-slate-400 font-black border-r">${i+1}</td>
                    <td class="p-4 flex items-center gap-4">
                        <img src="${getShield(s.name)}" class="w-10 h-10 object-contain" onerror="this.src='https://via.placeholder.com/40?text=${s.name.charAt(0)}'">
                        <span class="text-sm font-black">${s.name}</span>
                    </td>
                    <td class="p-4 text-center text-slate-500">${s.cats.size}</td>
                    <td class="p-4 text-center bg-blue-50 text-blue-800 font-black text-lg">${s.pts}</td>
                </tr>
            `).join('');
        }

        function render() {
            document.getElementById('team-grid').innerHTML = teams.sort().map(t => `
                <div class="bg-white p-4 rounded-2xl border border-slate-200 flex flex-col items-center gap-3 shadow-sm group relative">
                    <img src="${getShield(t)}" class="w-12 h-12 object-contain" onerror="this.src='https://via.placeholder.com/64?text=${t.substring(0,2)}'">
                    <span class="font-black text-[9px] uppercase text-center italic leading-tight">${t}</span>
                    ${isAdminActive ? `<button onclick="deleteTeam('${t}')" class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 text-[10px] font-bold">×</button>` : ''}
                </div>
            `).join('');

            const opts = teams.sort().map(t => `<option value="${t}">${t}</option>`).join('');
            document.getElementById('m-local').innerHTML = opts;
            document.getElementById('m-visitor').innerHTML = opts;

            const filterCat = document.getElementById('filter-cat-matches').value;
            const filtered = matches.filter(m => filterCat === "TODAS" || m.category === filterCat);

            document.getElementById('match-list').innerHTML = [...filtered].reverse().map(m => {
                const lWin = m.gL > m.gV;
                const vWin = m.gV > m.gL;
                const getBg = (w, o) => w ? 'bg-blue-600 text-white' : (o ? 'bg-red-600 text-white' : 'bg-slate-400 text-white');

                return `
                <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden border-t-4 border-t-slate-800">
                    <div class="bg-slate-50 p-2 flex justify-between px-4 border-b">
                        <span class="text-[9px] font-black text-slate-400 uppercase italic">${m.round}</span>
                        <span class="text-[9px] font-black text-blue-600 uppercase">${m.category}</span>
                    </div>
                    <div class="p-4 flex items-center justify-between gap-2">
                        <div class="flex-1 flex flex-col items-center gap-1">
                            <img src="${getShield(m.local)}" class="w-9 h-9 object-contain" onerror="this.src='https://via.placeholder.com/40'">
                            <span class="font-black text-[9px] text-center uppercase truncate w-full">${m.local}</span>
                            <div class="flex gap-0.5">
                                ${Array(m.yL).fill('<div class="card-yellow !w-[4px] !h-[7px]"></div>').join('')}
                                ${Array(m.rL).fill('<div class="card-red !w-[4px] !h-[7px]"></div>').join('')}
                            </div>
                        </div>
                        <div class="flex items-center gap-1.5">
                            <div class="w-9 h-10 flex items-center justify-center rounded-lg font-black text-xl shadow-md ${getBg(lWin, vWin)}">${m.gL}</div>
                            <span class="font-black text-slate-300 italic">-</span>
                            <div class="w-9 h-10 flex items-center justify-center rounded-lg font-black text-xl shadow-md ${getBg(vWin, lWin)}">${m.gV}</div>
                        </div>
                        <div class="flex-1 flex flex-col items-center gap-1">
                            <img src="${getShield(m.visitor)}" class="w-9 h-9 object-contain" onerror="this.src='https://via.placeholder.com/40'">
                            <span class="font-black text-[9px] text-center uppercase truncate w-full">${m.visitor}</span>
                            <div class="flex gap-0.5">
                                ${Array(m.yV).fill('<div class="card-yellow !w-[4px] !h-[7px]"></div>').join('')}
                                ${Array(m.rV).fill('<div class="card-red !w-[4px] !h-[7px]"></div>').join('')}
                            </div>
                        </div>
                    </div>
                    ${isAdminActive ? `<button onclick="deleteMatch(${m.id})" class="w-full py-1 bg-red-50 text-red-500 text-[8px] font-bold uppercase border-t">Eliminar Registro</button>` : ''}
                </div>
            `}).join('');

            if(document.getElementById('filter-cat-matches').options.length <= 1) {
                CATEGORIES.forEach(c => {
                    const opt = new Option(c, c);
                    document.getElementById('filter-cat-matches').add(opt);
                });
            }
        }

        async function exportarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFillColor(15, 23, 42);
            doc.rect(0, 0, 210, 25, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.text("AMF - REPORTE OFICIAL", 105, 12, { align: "center" });
            
            doc.setTextColor(0);
            if (currentTabId === 'tabla') {
                const cat = document.getElementById('filter-category-table').value;
                const data = getTableData(cat);
                doc.text(`Categoría: ${cat}`, 15, 35);
                doc.autoTable({
                    startY: 40,
                    head: [['Pos', 'Club', 'PJ', 'Pts', 'AM', 'RO']],
                    body: data.map((s, i) => [i+1, s.name, s.pj, s.pts, s.y, s.r]),
                    headStyles: { fillColor: [30, 41, 59] }
                });
            } else if(currentTabId === 'general') {
                doc.text(`Tabla General de Clubes`, 15, 35);
                updateGeneralTable(); 
                // Lógica de exportación general...
            }
            doc.save(`AMF_REPORT.pdf`);
        }

        function deleteTeam(n) { if(confirm(`¿Desea eliminar el club ${n}?`)) { teams = teams.filter(t => t !== n); save(); } }
        function deleteMatch(id) { if(confirm(`¿Desea borrar este resultado?`)) { matches = matches.filter(m => m.id !== id); save(); } }
        function save() {
            localStorage.setItem('amf_db_teams', JSON.stringify(teams));
            localStorage.setItem('amf_db_matches', JSON.stringify(matches));
            render();
        }
        function resetData() { 
            if(confirm("¡ALERTA! Se borrarán todos los datos. ¿Continuar?")) { 
                localStorage.clear(); 
                location.reload(); 
            } 
        }

        window.onload = () => { render(); showTab('equipos'); };
    </script>
</body>
</html>