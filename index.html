<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asociaci칩n Metropolitana de F칰tbol - Sistema Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { border-bottom: 4px solid #2563eb; color: #2563eb; background-color: rgba(37, 99, 235, 0.05); }
        
        .team-logo {
            width: 32px;
            height: 32px;
            object-fit: contain;
            margin-right: 12px;
        }

        .team-badge-fallback {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            color: white !important;
            font-weight: 900;
            font-size: 14px;
            margin-right: 12px;
            text-transform: uppercase;
        }

        /* Estilos especiales para la captura de imagen */
        .export-label { display: none; } /* Oculto en la web */
        .is-exporting .export-label { display: block; } /* Visible solo en la foto */
        .is-exporting .no-print { display: none !important; } /* Ocultar botones en la foto */
        .is-exporting #capture-area { width: 1000px !important; border-radius: 0 !important; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900">

    <div id="capture-area" class="max-w-6xl mx-auto md:my-10 bg-white md:rounded-[2rem] shadow-2xl overflow-hidden border border-slate-200">
        
        <!-- ENCABEZADO -->
        <div class="bg-slate-900 p-8 text-white flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-5">
                <img src="logo_liga.png" alt="Logo AMF" class="h-24 w-auto object-contain" onerror="this.src='https://via.placeholder.com/100?text=AMF'">
                <div class="text-center md:text-left">
                    <h1 class="text-3xl font-black tracking-tighter italic leading-tight uppercase text-white">
                        ASOCIACI칍N<br>
                        METROPOLITANA<br>
                        DE F칔TBOL
                    </h1>
                </div>
            </div>

            <div class="flex flex-wrap justify-center gap-3 no-print">
                <button id="btn-download" onclick="exportToImage()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-3 rounded-xl font-black text-[11px] uppercase transition-all shadow-lg flex items-center gap-2">
                    游닌 Descargar Imagen
                </button>
                <button onclick="resetData()" class="bg-red-500 text-white px-4 py-3 rounded-xl font-black text-[10px] uppercase transition-all">
                    Reiniciar
                </button>
            </div>

            <div class="flex items-center">
                <img src="logo_afa.png" alt="Logo AFA" class="h-24 w-auto object-contain" onerror="this.src='https://via.placeholder.com/100?text=AFA'">
            </div>
        </div>

        <main class="p-4 md:p-10">
            <!-- SECCI칍N RESULTADOS -->
            <div id="partidos" class="tab-content active">
                <div class="mb-8">
                    <h2 class="text-2xl font-black text-slate-800 uppercase italic">Resultados</h2>
                    <!-- T칤tulo din치mico para la imagen -->
                    <div id="export-category-name" class="export-label text-blue-600 font-black text-xl uppercase mt-2"></div>
                    
                    <div class="mt-4 flex flex-wrap items-center gap-3 no-print">
                        <select id="filter-category-matches" onchange="render()" class="bg-slate-100 p-2 rounded-lg font-bold text-xs uppercase outline-none">
                            <option value="TODAS">Ver Todas las Categor칤as</option>
                            <option value="SUB15 FEMENINO">SUB15 FEMENINO</option>
                            <option value="SUB17 FEMENINO">SUB17 FEMENINO</option>
                            <option value="1췈 DIVISION FEMENINIO">1췈 DIVISION FEMENINIO</option>
                            <option value="6췈 DIVISION">6췈 DIVISION</option>
                            <option value="5췈 DIVISION">5췈 DIVISION</option>
                            <option value="4췈 DIVISION">4췈 DIVISION</option>
                            <option value="3췈 DIVISION">3췈 DIVISION</option>
                            <option value="1췈 DIVISION">1췈 DIVISION</option>
                            <option value="SENIOR">SENIOR</option>
                        </select>
                    </div>
                </div>

                <!-- Formulario Carga (no-print) -->
                <div class="bg-slate-100 p-6 rounded-3xl mb-8 no-print">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                        <select id="m-category" class="p-3 rounded-xl font-bold uppercase text-xs">
                            <option value="SUB15 FEMENINO">SUB15 FEMENINO</option>
                            <option value="SUB17 FEMENINO">SUB17 FEMENINO</option>
                            <option value="1췈 DIVISION FEMENINIO">1췈 DIVISION FEMENINIO</option>
                            <option value="6췈 DIVISION">6췈 DIVISION</option>
                            <option value="5췈 DIVISION">5췈 DIVISION</option>
                            <option value="4췈 DIVISION">4췈 DIVISION</option>
                            <option value="3췈 DIVISION">3췈 DIVISION</option>
                            <option value="1췈 DIVISION">1췈 DIVISION</option>
                            <option value="SENIOR">SENIOR</option>
                        </select>
                        <input type="text" id="m-local" placeholder="Equipo Local" class="p-3 rounded-xl font-bold uppercase text-xs">
                        <input type="number" id="g-local" placeholder="Goles L" class="p-3 rounded-xl font-bold text-center">
                        <input type="number" id="g-visitor" placeholder="Goles V" class="p-3 rounded-xl font-bold text-center">
                        <input type="text" id="m-visitor" placeholder="Equipo Visitante" class="p-3 rounded-xl font-bold uppercase text-xs">
                        <button onclick="addMatch()" class="bg-blue-600 text-white p-3 rounded-xl font-black text-xs uppercase lg:col-span-4">Guardar Resultado</button>
                    </div>
                </div>

                <div id="match-list" class="space-y-3"></div>
            </div>

            <!-- TABLA DE POSICIONES (Sigue debajo de los resultados para la foto) -->
            <div id="tabla" class="mt-12">
                <h2 class="text-2xl font-black text-slate-800 uppercase italic mb-6">Tabla de Posiciones</h2>
                <div class="overflow-x-auto rounded-3xl border border-slate-200 bg-white">
                    <table class="w-full text-sm text-left">
                        <thead>
                            <tr class="bg-slate-900 text-white uppercase font-black text-[10px]">
                                <th class="p-4 text-center">Pos</th>
                                <th class="p-4">Club</th>
                                <th class="p-4 text-center">PJ</th>
                                <th class="p-4 text-center">PTS</th>
                            </tr>
                        </thead>
                        <tbody id="standings-body" class="divide-y divide-slate-100 font-bold"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        /**
         * GU칈A DE CAMBIOS PARA EL USUARIO
         * -------------------------------
         * 1. CATEGOR칈AS: Si quieres cambiar los nombres de las divisiones, b칰scalas en el HTML arriba 
         * (etiquetas <option>) y cambia el texto.
         * 2. COLORES: Para cambiar colores de botones, busca clases como 'bg-blue-600' y c치mbialas 
         * por 'bg-red-600', 'bg-emerald-500', etc.
         * 3. LOGOS: Cambia "logo_liga.png" por la direcci칩n URL de tu logo real.
         */

        let teams = JSON.parse(localStorage.getItem('amf_teams')) || [];
        let matches = JSON.parse(localStorage.getItem('amf_matches')) || [];

        function addMatch() {
            const cat = document.getElementById('m-category').value;
            const loc = document.getElementById('m-local').value.trim().toUpperCase();
            const vis = document.getElementById('m-visitor').value.trim().toUpperCase();
            const gl = document.getElementById('g-local').value;
            const gv = document.getElementById('g-visitor').value;

            if(!loc || !vis) return alert("Faltan nombres de equipos");
            if(gl === "" || gv === "") return alert("Faltan goles");

            if(!teams.includes(loc)) teams.push(loc);
            if(!teams.includes(vis)) teams.push(vis);

            matches.push({
                category: cat,
                local: loc,
                visitor: vis,
                gL: parseInt(gl),
                gV: parseInt(gv),
                id: Date.now()
            });

            save();
            document.getElementById('g-local').value = "";
            document.getElementById('g-visitor').value = "";
        }

        function save() {
            localStorage.setItem('amf_teams', JSON.stringify(teams));
            localStorage.setItem('amf_matches', JSON.stringify(matches));
            render();
        }

        function render() {
            const filter = document.getElementById('filter-category-matches').value;
            
            // Actualizar el t칤tulo que saldr치 en la captura
            document.getElementById('export-category-name').innerText = "CATEGOR칈A: " + filter;

            let filtered = matches;
            if(filter !== "TODAS") filtered = matches.filter(m => m.category === filter);

            document.getElementById('match-list').innerHTML = filtered.slice().reverse().map(m => `
                <div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm flex items-center justify-between">
                    <div class="w-24 text-[8px] font-black text-blue-500 uppercase">${m.category}</div>
                    <div class="flex-1 text-right font-black uppercase text-xs">${m.local}</div>
                    <div class="flex items-center mx-4 gap-2">
                        <span class="bg-slate-900 text-white w-8 h-8 flex items-center justify-center rounded-lg font-black">${m.gL}</span>
                        <span class="bg-slate-900 text-white w-8 h-8 flex items-center justify-center rounded-lg font-black">${m.gV}</span>
                    </div>
                    <div class="flex-1 text-left font-black uppercase text-xs">${m.visitor}</div>
                    <button onclick="deleteMatch(${m.id})" class="no-print ml-2 text-red-300 hover:text-red-600">칑</button>
                </div>
            `).join('');

            updateStandings(filter);
        }

        function updateStandings(filter) {
            const table = {};
            teams.forEach(t => table[t] = { name: t, pj: 0, pts: 0 });

            const mFiltered = (filter === "TODAS") ? matches : matches.filter(m => m.category === filter);

            mFiltered.forEach(m => {
                table[m.local].pj++;
                table[m.visitor].pj++;
                if(m.gL > m.gV) table[m.local].pts += 3;
                else if(m.gV > m.gL) table[m.visitor].pts += 3;
                else { table[m.local].pts += 1; table[m.visitor].pts += 1; }
            });

            const sorted = Object.values(table)
                .filter(t => t.pj > 0)
                .sort((a,b) => b.pts - a.pts);

            document.getElementById('standings-body').innerHTML = sorted.map((s, i) => `
                <tr>
                    <td class="p-4 text-center text-slate-400">${i+1}</td>
                    <td class="p-4 uppercase text-xs">${s.name}</td>
                    <td class="p-4 text-center">${s.pj}</td>
                    <td class="p-4 text-center bg-blue-50 text-blue-600 font-black">${s.pts}</td>
                </tr>
            `).join('');
        }

        function deleteMatch(id) {
            matches = matches.filter(m => m.id !== id);
            save();
        }

        async function exportToImage() {
            const btn = document.getElementById('btn-download');
            btn.innerText = "GENERANDO...";
            btn.disabled = true;

            // ACTIVAR MODO EXPORTACI칍N (Para que se vea la categor칤a en la foto)
            document.body.classList.add('is-exporting');

            // Esperar un instante para que el navegador aplique los estilos
            await new Promise(resolve => setTimeout(resolve, 300));

            try {
                const canvas = await html2canvas(document.getElementById('capture-area'), {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: "#ffffff"
                });

                const link = document.createElement('a');
                link.download = `AMF_REPORTE_${new Date().getTime()}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            } catch (e) {
                alert("Error al descargar. Intenta de nuevo.");
            } finally {
                document.body.classList.remove('is-exporting');
                btn.innerText = "游닌 Descargar Imagen";
                btn.disabled = false;
            }
        }

        function resetData() {
            if(confirm("쮹orrar todo?")) { localStorage.clear(); location.reload(); }
        }

        window.onload = render;
    </script>
</body>
</html>
